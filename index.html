<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitio para Vender Páginas Web</title>
    <style>
        /* Diseño básico en blanco y negro, sin estética avanzada */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            color: black;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid black;
        }

        .hamburger-menu button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        #nav-menu {
            position: absolute;
            top: 50px;
            left: 10px;
            background: white;
            border: 1px solid black;
            padding: 10px;
        }

        .hidden {
            display: none;
        }

        .search-bar {
            display: flex;
        }

        #search-input {
            border: 1px solid black;
            padding: 5px;
        }

        #search-btn {
            border: 1px solid black;
            background: white;
            cursor: pointer;
        }

        #search-results {
            position: absolute;
            background: white;
            border: 1px solid black;
            max-height: 200px;
            overflow-y: auto;
        }

        .login-section button {
            border: 1px solid black;
            background: white;
            cursor: pointer;
        }

        #login-form {
            position: absolute;
            background: white;
            border: 1px solid black;
            padding: 10px;
        }

        #mantenimiento-banner {
            background: yellow; /* Para visibilidad, pero básico */
            text-align: center;
            padding: 10px;
        }

        #banner {
            text-align: center;
        }

        #banner-img {
            max-width: 100%;
        }

        section {
            padding: 20px;
            border-bottom: 1px solid black;
        }

        footer {
            padding: 10px;
            text-align: center;
            border-top: 1px solid black;
        }

        #redes-sociales a {
            margin: 0 10px;
            color: black;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <header>
        <!-- Menú Hamburguesa -->
        <div class="hamburger-menu">
            <button id="hamburger-btn">☰</button>
            <nav id="nav-menu" class="hidden">
                <ul>
                    <li><a href="#seccion1">Sección 1</a></li>
                    <li><a href="#seccion2">Sección 2</a></li>
                    <li><a href="#seccion3">Sección 3</a></li>
                    <!-- Atajos dinámicos se agregarán aquí -->
                </ul>
            </nav>
        </div>

        <!-- Barra de Búsquedas -->
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Buscar previews de páginas...">
            <button id="search-btn">Buscar</button>
            <div id="search-results" class="hidden"></div>
        </div>

        <!-- Iniciar Sesión -->
        <div class="login-section">
            <button id="login-btn">Iniciar Sesión</button>
            <div id="login-form" class="hidden">
                <input type="email" id="email" placeholder="Email">
                <input type="password" id="password" placeholder="Contraseña">
                <button id="submit-login">Entrar</button>
                <button id="logout-btn" class="hidden">Cerrar Sesión</button>
            </div>
        </div>

        <!-- Título Principal -->
        <h1 id="titulo-principal">Cargando Título...</h1>
    </header>

    <!-- Banner de Mantenimiento (oculto por default) -->
    <div id="mantenimiento-banner" class="hidden">
        <p>Página en Mantenimiento</p>
    </div>

    <!-- Banner con Imagen -->
    <div id="banner">
        <img id="banner-img" src="" alt="Banner">
    </div>

    <!-- Secciones Principales -->
    <main>
        <section id="seccion1">
            <h2 id="titulo-seccion1">Cargando Sección 1...</h2>
            <!-- Contenido dinámico: previews, textos, etc. -->
            <div id="contenido-seccion1"></div>
        </section>

        <section id="seccion2">
            <h2 id="titulo-seccion2">Cargando Sección 2...</h2>
            <div id="contenido-seccion2"></div>
        </section>

        <section id="seccion3">
            <h2 id="titulo-seccion3">Cargando Sección 3...</h2>
            <div id="contenido-seccion3"></div>
        </section>
    </main>

    <!-- Atajos (se renderizan en menú, pero lista base aquí para referencia) -->
    <div id="atajos-container" class="hidden">
        <!-- Atajos dinámicos -->
    </div>

    <!-- Redes Sociales -->
    <footer>
        <div id="redes-sociales">
            <!-- Icons dinámicos -->
        </div>
    </footer>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-analytics.js";
        import { getDatabase, ref as dbRef, get, set } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyCSu34Ls6HzmX1ANI19KPzttAKTqf5bDxY",
          authDomain: "tuwebyaa-da5a4.firebaseapp.com",
          projectId: "tuwebyaa-da5a4",
          storageBucket: "tuwebyaa-da5a4.firebasestorage.app",
          messagingSenderId: "978686266841",
          appId: "1:978686266841:web:33ffcb2ff2965589151dc8",
          measurementId: "G-X1FY1MR0M7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // Lógica del Menú Hamburguesa
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const navMenu = document.getElementById('nav-menu');

        hamburgerBtn.addEventListener('click', () => {
            navMenu.classList.toggle('hidden');
        });

        // Lógica de Barra de Búsquedas
        // Asumimos que busca en previews almacenados en Firebase bajo /previews
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const searchResults = document.getElementById('search-results');

        searchBtn.addEventListener('click', () => {
            const query = searchInput.value.toLowerCase();
            searchResults.innerHTML = '';
            searchResults.classList.remove('hidden');

            get(dbRef(db, 'previews')).then(snapshot => {
                const previews = snapshot.val();
                if (previews) {
                    Object.values(previews).forEach(preview => {
                        if (preview.title.toLowerCase().includes(query)) {
                            const resultDiv = document.createElement('div');
                            resultDiv.innerHTML = `<p>${preview.title}</p><img src="${preview.image}" alt="${preview.title}" style="max-width:100px;">`;
                            resultDiv.addEventListener('click', () => {
                                // Redirigir a preview detalle (lógica futura)
                                window.location.href = `#preview-${preview.id}`;
                            });
                            searchResults.appendChild(resultDiv);
                        }
                    });
                }
            }).catch(error => console.error('Error en búsqueda:', error));
        });

        // Lógica de Iniciar Sesión
        const loginBtn = document.getElementById('login-btn');
        const loginForm = document.getElementById('login-form');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const submitLogin = document.getElementById('submit-login');
        const logoutBtn = document.getElementById('logout-btn');

        loginBtn.addEventListener('click', () => {
            loginForm.classList.toggle('hidden');
        });

        submitLogin.addEventListener('click', () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            signInWithEmailAndPassword(auth, email, password)
                .then(userCredential => {
                    console.log('Usuario logueado:', userCredential.user);
                    loginBtn.classList.add('hidden');
                    logoutBtn.classList.remove('hidden');
                    // Cargar datos admin si es admin (lógica futura)
                })
                .catch(error => console.error('Error en login:', error));
        });

        logoutBtn.addEventListener('click', () => {
            signOut(auth).then(() => {
                console.log('Sesión cerrada');
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
            }).catch(error => console.error('Error en logout:', error));
        });

        // Cargar Título Principal desde Firebase
        get(dbRef(db, 'config/titulo_principal')).then(snapshot => {
            const titulo = snapshot.val() || 'Sitio para Vender Páginas Web';
            document.getElementById('titulo-principal').textContent = titulo;
        });

        // Cargar Títulos de Secciones
        ['1', '2', '3'].forEach(num => {
            get(dbRef(db, `config/seccion${num}/titulo`)).then(snapshot => {
                const titulo = snapshot.val() || `Sección ${num}`;
                document.getElementById(`titulo-seccion${num}`).textContent = titulo;
            });

            // Cargar Contenido Dinámico (textos, previews, etc.)
            get(dbRef(db, `config/seccion${num}/contenido`)).then(snapshot => {
                const contenido = snapshot.val();
                if (contenido) {
                    const contDiv = document.getElementById(`contenido-seccion${num}`);
                    // Renderizar textos, imágenes, etc. (asumimos array de objetos {type: 'text'|'image', value: '', style: {font: '', position: ''}})
                    contenido.forEach(item => {
                        if (item.type === 'text') {
                            const p = document.createElement('p');
                            p.textContent = item.value;
                            p.style.fontFamily = item.style?.font || 'Arial';
                            p.style.position = item.style?.position || 'relative'; // Para movimiento libre (admin setea CSS)
                            contDiv.appendChild(p);
                        } else if (item.type === 'image') {
                            const img = document.createElement('img');
                            img.src = item.value;
                            img.style.position = item.style?.position || 'relative';
                            contDiv.appendChild(img);
                        }
                        // Previews: si es preview, renderizar como cards
                    });
                }
            });
        });

        // Cargar Atajos (máximo 6)
        get(dbRef(db, 'config/atajos')).then(snapshot => {
            const atajos = snapshot.val() || [];
            const ul = navMenu.querySelector('ul');
            atajos.slice(0, 6).forEach(atajo => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = atajo.url;
                a.textContent = atajo.nombre;
                li.appendChild(a);
                ul.appendChild(li);
            });
        });

        // Cargar Redes Sociales
        const redes = ['instagram', 'facebook', 'youtube', 'x'];
        const redesContainer = document.getElementById('redes-sociales');

        redes.forEach(red => {
            get(dbRef(db, `config/redes/${red}`)).then(snapshot => {
                const config = snapshot.val();
                if (config && config.on) {
                    const a = document.createElement('a');
                    a.href = config.link || `https://www.${red}.com/${config.usuario}`;
                    a.textContent = red.charAt(0).toUpperCase() + red.slice(1);
                    redesContainer.appendChild(a);
                }
            });
        });

        // Banner de Mantenimiento
        get(dbRef(db, 'config/mantenimiento')).then(snapshot => {
            const on = snapshot.val();
            if (on) {
                document.getElementById('mantenimiento-banner').classList.remove('hidden');
            }
        });

        // Banner Imagen
        get(dbRef(db, 'config/banner/imagen')).then(snapshot => {
            const imgUrl = snapshot.val();
            if (imgUrl) {
                document.getElementById('banner-img').src = imgUrl;
            }
        });

        // Nota: Para el admin, crearás un admin.html separado que use auth para verificar admin, y luego use set(dbRef(db, path), value) para actualizar estos paths en Firebase.
        // Por ahora, el index está preparado para leer de estos paths.
        // Previews: Almacena en /previews/{id: {title, image, description}} para búsqueda y render en secciones.
    </script>
</body>
</html>
